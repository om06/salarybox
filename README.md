## Salarybox Assignment

## Installation
Run the follwoing commands in sequence to install the project

Prequisites

 1. python 3.10: https://www.python.org/downloads/
 2. Virtual environments: https://docs.python.org/3/library/venv.html
 3. redis: https://redis.io/docs/getting-started/
 4. For the simplicity Sqlite (Default Django DB) has been used in this project

```
cd
mkdir salarybox
cd salarybox
python3 -m venv env
source env/bin/activate
git clone https://github.com/om06/salarybox.git
cd salarybox
pip install -r requirements.txt
python manage.py migrate
```
Load initial data
```
python manage.py loaddata fixtures/user.json --app auth
python manage.py loaddata fixtures/coordinates.json --app coordinates
```
Create superuser to access django-admin via below command
`python manage.py createsuperuser`

Runserver
`python manage.py runserver 8000`

In another terminal run the below command to start celery worker
`python -m celery -A salarybox worker`

Access the Admin panel on 
`http://localhost:8000`

**Please note**:
If you are creating a new user than to generate the token you must create an entry in `Token` table either by Admin panel or Shell, auto token generation featue has not been included in this project.

## API
Added in the repo itself in file `api-doc.yaml`

All the APIs are very straightforward except graph generation and load csv API.
There are two APIs for both the cases:
- `Add task` API create an entry in the DB which keeps the track of the task status and errors.
- `Get status` API to check the status of the task using the reference_id generated by above API.

- In case of graph API, Calling status API will also return the url of the image if the status is `completed`

## FAQs

1. Why the application folder is outside the project folder?
- To make the application loosely coupled, if we want to use the `coordinates` application in some other project we just have to move the folder and add the app name in settings file and provide one entry point.

2. Why business logic is added inside manager class?
- To make the code more modular, we can reuse the manager class anywhere in the code and also the unit testing is much easier.



## Improvements

 1. Permissions can be managed by default `permission` and `groups` model provided by Django, Since the usecase was to check whether the user is GroupLeader or not I am simply checking the entry in `GroupLeader` entry.
 2. We can check whether the user is active or not before allowing him to use the API
 3. Logs can be added inside the manager class and also logs configuration is missing from the settings
 4. Settings can be refactored further into `local`, `testing`, `staging`, `production`, `default`
 5. `Pagination` is missing in the Points list API
 6. We can generate the graph on the basis of date range, rather than including the complete set of points in the graph.
 7. `created_at` time can be added in csv file to store the exact time of points addition rather than auto generating to current time in case of points being loaded from csv file.
 8. Instead of running the task asynchronously, we could use cron job to pick the task from db, it will also make the process fail safe.
 
## Known issues
 
 1. Graph API is not working as expected, it is working fine in the shell but while running via API, the server is getting stopped unexpectedly, need to further inspect the issue, however I tried to add the base logic to generate the graph.
